CREATE TABLE tmp_out AS 
SELECT lo_from_bytea(0,ST_AsGDALRaster(ST_Union(rast), 'GTiff',
									   ARRAY['COMPRESS=DEFLATE','PREDICTOR=2', 'PZLEVEL=9'])) AS loid
FROM public.uk_250k;

SELECT lo_export(loid, 'uk_250k.tiff') --exporting
FROM tmp_out;

-- b.Tworzymy indeks przestrzenny
CREATE INDEX idx_uk_250k ON public.uk_250k
USING gist (ST_ConvexHull(rast));

--ZAD 6
CREATE TABLE public.uk_lake_district AS
SELECT ST_Clip(uk.rast, parks.geom, true)
FROM public.uk_250k AS uk, public.national_parks AS parks
WHERE ST_Intersects(uk.rast, parks.geom) AND parks.id=1;

CREATE TABLE public.uk_lake_district AS
SELECT ST_Clip(a.rast, b.geom, true)
FROM public.uk_250k AS a, public.national_parks AS b
WHERE ST_Intersects(a.rast, b.geom) AND b.id=1;

CREATE TABLE tmp_out AS
SELECT lo_from_bytea(0,
       ST_AsGDALRaster(ST_Union(rast), 'GTiff',  ARRAY['COMPRESS=DEFLATE', 'PREDICTOR=2', 'PZLEVEL=9'])
        ) AS loid
FROM public.uk_lake_district;
SELECT lo_export(loid, 'uk_lake_district.tif')
FROM tmp_out;


